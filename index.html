<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <title>24Games - Redirecionando...</title>

    <!-- Redirect Script -->
    <script>
      (function() {
        // 1. Configurações
        const tempoEspera = 3000; // 3 segundos
        
        // Captura o pathname logo no início, antes do React Router
        var initialPathname = window.location.pathname;
        
        // Landing pages conhecidas
        var landingPages = {
          'supercuota': {
            baseUrl: 'https://go.aff.24gamespartners.com/3w15f015',
            utmPrefix: 'sportbook_'
          }
        };
        
        // 2. Função para pegar Cookies (FBP e FBC)
        const getCookie = (name) => {
          let value = "; " + document.cookie;
          let parts = value.split("; " + name + "=");
          if (parts.length === 2) return parts.pop().split(";").shift();
        };
        
        // Função para detectar landing page e slug
        function getLandingPageAndSlug() {
          // Usa o pathname inicial capturado
          var pathname = initialPathname || window.location.pathname;
          var segments = pathname.replace(/^\//, '').split('/').filter(function(s) { return s && s.length > 0; });
          
          var landingPage = null;
          var slug = 'cr1'; // padrão
          
          if (segments.length >= 2) {
            // Ex: /supercuota/cr1
            landingPage = segments[0];
            slug = segments[1];
          } else if (segments.length === 1) {
            // Ex: /cr1 ou /supercuota
            if (landingPages[segments[0]]) {
              landingPage = segments[0];
              slug = 'cr1'; // padrão para landing page sem slug
            } else {
              landingPage = null;
              slug = segments[0];
            }
          }
          
          return { landingPage: landingPage, slug: slug };
        }
        
        // Função para gerar o URL de redirecionamento base
        function getRedirectUrl() {
          var result = getLandingPageAndSlug();
          var landingPage = result.landingPage;
          var slug = result.slug;
          
          var config = landingPages[landingPage] || {
            baseUrl: 'https://go.aff.24gamespartners.com/ep66d86x',
            utmPrefix: 'casino_'
          };
          
          var baseUrl = config.baseUrl + '?utm_campaign=' + config.utmPrefix + slug;
          return baseUrl;
        }
        
        // 3. Capturar parâmetros da URL atual
        const urlParams = new URLSearchParams(window.location.search);
        const paramsEncontrados = {};

        // Lista de parâmetros que queremos carregar
        const trackers = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'gclid', 'fbclid'];
        
        trackers.forEach(param => {
          if (urlParams.has(param)) {
            paramsEncontrados[param] = urlParams.get(param);
            // Salva no localStorage para persistência futura
            localStorage.setItem(param, urlParams.get(param));
          } else if (localStorage.getItem(param)) {
            // Se não tá na URL mas tá no storage, recupera
            paramsEncontrados[param] = localStorage.getItem(param);
          }
        });

        // 4. Adicionar FBP e FBC dos cookies (Facebook Pixel)
        const fbp = getCookie('_fbp');
        const fbc = getCookie('_fbc');
        if (fbp) paramsEncontrados['fbp'] = fbp;
        if (fbc) paramsEncontrados['fbc'] = fbc;

        // 5. Construir URL Final
        const urlDestinoBase = getRedirectUrl();
        const novaUrlDestino = new URL(urlDestinoBase);
        
        // Adiciona todos os parâmetros encontrados à URL
        Object.keys(paramsEncontrados).forEach(key => {
          novaUrlDestino.searchParams.set(key, paramsEncontrados[key]);
        });

        console.log("Redirecionando para: " + novaUrlDestino.toString());

        // 6. Função de redirect que pode ser chamada de múltiplas formas
        function performRedirect() {
          try {
            if (novaUrlDestino.toString()) {
              window.location.href = novaUrlDestino.toString();
            }
          } catch (e) {
            console.error('Redirect error:', e);
          }
        }
        
        // 7. Executar o Redirecionamento após o tempo definido
        // Executa quando a página carrega
        if (document.readyState === 'loading') {
          window.addEventListener('load', function() {
            setTimeout(performRedirect, tempoEspera);
          });
        } else {
          // Se já carregou, executa direto
          setTimeout(performRedirect, tempoEspera);
        }
        
        // Backup: executa após um tempo maior caso o anterior não funcione
        setTimeout(performRedirect, tempoEspera + 2000);
      })();
    </script>

    <!-- Backredirect -->
    <script>
      (function() {
        // Função para pegar Cookies (FBP e FBC)
        const getCookie = (name) => {
          let value = "; " + document.cookie;
          let parts = value.split("; " + name + "=");
          if (parts.length === 2) return parts.pop().split(";").shift();
        };
        
        // Captura o pathname logo no início
        var initialPathname = window.location.pathname;
        
        // Landing pages conhecidas
        var landingPages = {
          'supercuota': {
            baseUrl: 'https://go.aff.24gamespartners.com/3w15f015',
            utmPrefix: 'sportbook_'
          }
        };
        
        // Função para detectar landing page e slug
        function getLandingPageAndSlug() {
          var pathname = initialPathname || window.location.pathname;
          var segments = pathname.replace(/^\//, '').split('/').filter(function(s) { return s && s.length > 0; });
          
          var landingPage = null;
          var slug = 'cr1'; // padrão
          
          if (segments.length >= 2) {
            landingPage = segments[0];
            slug = segments[1];
          } else if (segments.length === 1) {
            if (landingPages[segments[0]]) {
              landingPage = segments[0];
              slug = 'cr1';
            } else {
              landingPage = null;
              slug = segments[0];
            }
          }
          
          return { landingPage: landingPage, slug: slug };
        }
        
        // Função para gerar o URL de redirecionamento
        function getRedirectUrl() {
          var result = getLandingPageAndSlug();
          var landingPage = result.landingPage;
          var slug = result.slug;
          
          var config = landingPages[landingPage] || {
            baseUrl: 'https://go.aff.24gamespartners.com/ep66d86x',
            utmPrefix: 'casino_'
          };
          
          var baseUrl = config.baseUrl + '?utm_campaign=' + config.utmPrefix + slug;
          return baseUrl;
        }
        
        // Função para construir URL com todos os parâmetros
        function buildRedirectUrlWithParams() {
          const urlParams = new URLSearchParams(window.location.search);
          const paramsEncontrados = {};

          // Lista de parâmetros que queremos carregar
          const trackers = ['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content', 'gclid', 'fbclid'];
          
          trackers.forEach(param => {
            if (urlParams.has(param)) {
              paramsEncontrados[param] = urlParams.get(param);
            } else if (localStorage.getItem(param)) {
              paramsEncontrados[param] = localStorage.getItem(param);
            }
          });

          // Adicionar FBP e FBC dos cookies (Facebook Pixel)
          const fbp = getCookie('_fbp');
          const fbc = getCookie('_fbc');
          if (fbp) paramsEncontrados['fbp'] = fbp;
          if (fbc) paramsEncontrados['fbc'] = fbc;

          // Construir URL Final
          const urlDestinoBase = getRedirectUrl();
          const novaUrlDestino = new URL(urlDestinoBase);
          
          // Adiciona todos os parâmetros encontrados à URL
          Object.keys(paramsEncontrados).forEach(key => {
            novaUrlDestino.searchParams.set(key, paramsEncontrados[key]);
          });
          
          return novaUrlDestino.toString();
        }
        
        var back_redirect_back_link = buildRedirectUrlWithParams();
        history.pushState({}, "", location.href);
        history.pushState({}, "", location.href);
        window.onpopstate = function () {
          setTimeout(function () {
            location.href = back_redirect_back_link;
          }, 1);
        };
      })();
    </script>
    <!-- Backredirect -->

    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '1108404008025075');
      fbq('track', 'PageView');
    </script>
    <!-- End Meta Pixel Code -->

    <!-- Meta Pixel Code -->
    <script>
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '820242960355032');
      fbq('track', 'PageView');
    </script>
    <!-- End Meta Pixel Code -->
  </head>
  <body>
    <!-- Meta Pixel Noscript -->
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1108404008025075&ev=PageView&noscript=1"
    /></noscript>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=820242960355032&ev=PageView&noscript=1"
    /></noscript>
    
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>

